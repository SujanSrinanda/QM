{% extends 'QuizMania/base.html' %}

{% block title %}Quiz History - {{ quiz.title }}{% endblock %}

{% block content %}
<link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap"
    rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* --- THEME VARIABLES --- */
    :root {
        --neon-blue: #00f3ff;
        --neon-pink: #ff00ff;
        --dark-bg: #050510;
        --glass-bg: rgba(10, 10, 30, 0.6);
    }

    html,
    body {
        background-color: var(--dark-bg);
        color: white;
        font-family: 'Rajdhani', sans-serif;
    }

    .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 243, 255, 0.2);
    }

    th {
        font-family: 'Orbitron', sans-serif;
        color: var(--neon-blue);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
</style>

<div class="min-h-screen pt-24 pb-12 px-6">
    <div class="max-w-4xl mx-auto">

        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <a href="{% url 'home' %}" class="text-sm text-gray-400 hover:text-white transition mb-2 inline-block">
                    <i class="fas fa-arrow-left"></i> BACK TO DASHBOARD
                </a>
                <h1 class="text-3xl font-bold font-orbitron text-white">
                    <span class="text-pink-500">HISTORY:</span> {{ quiz.title }}
                </h1>
                <p class="text-gray-400 text-sm mt-1">Archived results from past sessions.</p>
            </div>

            {% if history %}
            <!-- Delete Button Form -->
            <form action="{% url 'delete_quiz_history' quiz.code %}" method="POST"
                onsubmit="return confirm('WARNING: This will PERMANENTLY DELETE all history for this quiz. This action cannot be undone. Are you sure?');">
                {% csrf_token %}
                <button type="submit"
                    class="border border-red-500 text-red-400 hover:bg-red-500/20 px-4 py-2 rounded font-orbitron text-xs transition">
                    <i class="fas fa-trash-alt mr-2"></i> DELETE HISTORY
                </button>
            </form>
            {% endif %}
        </div>

        <!-- History Table -->
        <div class="glass-panel rounded-xl overflow-hidden">
            {% if history %}
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-blue-900/20 border-b border-gray-700">
                        <th class="p-4 text-xs">Date</th>
                        <th class="p-4 text-xs">Player Alias</th>
                        <th class="p-4 text-xs text-right">Score</th>
                    </tr>
                </thead>
                <tbody class="text-sm">
                    {% for record in history %}
                    <tr class="border-b border-gray-800 hover:bg-white/5 transition">
                        <td class="p-4 text-gray-400">{{ record.completed_at|date:"M d, Y H:i" }}</td>
                        <td class="p-4 font-bold text-white">{{ record.player_name }}</td>
                        <td class="p-4 text-right font-mono text-blue-300">{{ record.score }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-12 text-center text-gray-500">
                <i class="fas fa-history text-4xl mb-4 opacity-50"></i>
                <p>No archived history found for this quiz.</p>
                <p class="text-xs mt-2">End a session to archive results here.</p>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}