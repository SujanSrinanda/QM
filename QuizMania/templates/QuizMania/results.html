{% extends 'QuizMania/base.html' %}

{% block title %}Results - {{ quiz.title }}{% endblock %}

{% block content %}

<!-- 
        NEON THEME STYLES 
    -->
<link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap"
    rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* --- THEME VARIABLES --- */
    :root {
        --neon-blue: #00f3ff;
        --neon-pink: #ff00ff;
        --neon-gold: #ffd700;
        --neon-silver: #c0c0c0;
        --neon-bronze: #cd7f32;
        --dark-bg: #050510;
        --glass-bg: rgba(10, 10, 30, 0.6);
    }

    /* FORCE DARK BACKGROUND */
    html,
    body {
        background-color: var(--dark-bg) !important;
        color: white !important;
        font-family: 'Rajdhani', sans-serif;
        min-height: 100vh;
        margin: 0;
        overflow-x: hidden;
    }

    /* AGGRESSIVE RESET */
    body>div,
    main,
    section {
        background-color: transparent !important;
    }

    /* --- ANIMATED BACKGROUND --- */
    .cyber-grid-fixed {
        position: fixed;
        top: 0;
        left: 0;
        width: 200vw;
        height: 200vh;
        background-color: var(--dark-bg);
        background-image:
            linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        transform: perspective(500px) rotateX(60deg) translateY(-100px) translateZ(-200px);
        animation: grid-move 20s linear infinite;
        z-index: 0;
        pointer-events: none;
    }

    @keyframes grid-move {
        0% {
            transform: perspective(500px) rotateX(60deg) translateY(0) translateZ(-200px);
        }

        100% {
            transform: perspective(500px) rotateX(60deg) translateY(50px) translateZ(-200px);
        }
    }

    /* --- UTILITIES --- */
    .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 243, 255, 0.2);
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
    }

    .nav-scanline {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
        animation: scan-nav 4s linear infinite;
    }

    @keyframes scan-nav {
        0% {
            transform: translateX(-100%);
        }

        100% {
            transform: translateX(100%);
        }
    }

    /* --- RANKING STYLES --- */

    /* Base Rank Item */
    .rank-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(0, 20, 40, 0.6);
        border-left: 4px solid var(--neon-blue);
        border-bottom: 1px solid rgba(0, 243, 255, 0.1);
        margin-bottom: 0.8rem;
        padding: 1rem 1.5rem;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        border-radius: 0 4px 4px 0;
    }

    .rank-item:hover {
        background: rgba(0, 243, 255, 0.1);
        transform: translateX(10px);
    }

    /* Rank Number Badge */
    .rank-badge {
        font-family: 'Orbitron', sans-serif;
        font-weight: bold;
        font-size: 1.2rem;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        margin-right: 1rem;
        flex-shrink: 0;
    }

    /* Username Styling */
    .player-name {
        font-size: 1.1rem;
        font-weight: 600;
        flex-grow: 1;
        letter-spacing: 1px;
        color: white;
    }

    /* Score Styling */
    .player-score {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.2rem;
        color: var(--neon-pink);
        text-shadow: 0 0 5px var(--neon-pink);
    }

    /* --- TOP 3 STYLING --- */
    /* 1st Place - Gold */
    .rank-1 {
        border-left-color: var(--neon-gold);
        background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), transparent);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
    }

    .rank-1 .rank-badge {
        color: var(--neon-gold);
        border: 2px solid var(--neon-gold);
        text-shadow: 0 0 10px var(--neon-gold);
        background: rgba(0, 0, 0, 0.5);
    }

    .rank-1 .player-score {
        color: var(--neon-gold);
        text-shadow: 0 0 5px var(--neon-gold);
    }

    .rank-1::after {
        content: 'ðŸ‘‘';
        position: absolute;
        right: 50px;
        /* Positioned before score */
        top: 50%;
        transform: translateY(-50%);
        opacity: 0.4;
        font-size: 1.5rem;
    }

    /* 2nd Place - Silver */
    .rank-2 {
        border-left-color: var(--neon-silver);
    }

    .rank-2 .rank-badge {
        color: var(--neon-silver);
        border: 2px solid var(--neon-silver);
    }

    .rank-2 .player-score {
        color: var(--neon-silver);
        text-shadow: 0 0 5px var(--neon-silver);
    }

    /* 3rd Place - Bronze */
    .rank-3 {
        border-left-color: var(--neon-bronze);
    }

    .rank-3 .rank-badge {
        color: var(--neon-bronze);
        border: 2px solid var(--neon-bronze);
    }

    .rank-3 .player-score {
        color: var(--neon-bronze);
        text-shadow: 0 0 5px var(--neon-bronze);
    }

    /* Cyber Buttons */
    .btn-cyber {
        position: relative;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        font-family: 'Orbitron', sans-serif;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: white;
        background: transparent;
        border: 1px solid var(--neon-blue);
        overflow: hidden;
        transition: 0.3s;
        clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        padding: 1rem 2rem;
    }

    .btn-cyber:hover {
        background: rgba(0, 243, 255, 0.1);
        text-shadow: 0 0 10px var(--neon-blue);
        box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
    }
</style>

<!-- Background Animation -->
<div class="cyber-grid-fixed"></div>

<!-- Navigation Bar -->
<nav class="fixed top-0 w-full glass-panel z-50 px-6 py-4">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-2 group">
            <i class="fas fa-brain text-3xl text-pink-500 group-hover:animate-pulse"></i>
            <div class="text-2xl font-bold tracking-widest text-white brand-font">
                QUIZ <span class="text-blue-400">MANIA</span>
            </div>
        </a>

        <!-- Nav Links -->
        <div class="hidden md:flex items-center gap-8 text-sm font-bold tracking-widest">
            {% if user.is_authenticated %}
            <div class="flex gap-4 items-center">
                <a href="{% url 'logout' %}"
                    class="border border-red-500 px-4 py-1 text-red-400 hover:bg-red-500/20 rounded text-xs flex items-center transition">
                    LOGOUT
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="nav-scanline"></div>
</nav>

<!-- Main Content -->
<div class="min-h-screen w-full flex items-center justify-center px-4 pt-24 pb-10 relative z-10">

    <!-- Results Card -->
    <div class="glass-panel w-full max-w-3xl p-8 md:p-12 rounded-xl relative">

        <!-- Header -->
        <div class="text-center mb-10">
            <div
                class="inline-block px-3 py-1 rounded border border-blue-500/30 bg-blue-900/20 text-blue-300 text-[10px] tracking-[0.3em] mb-4">
                MISSION COMPLETE
            </div>
            <h1 class="text-3xl md:text-4xl font-bold font-orbitron text-white tracking-wider mb-2">
                RESULTS FOR <span class="text-neon-blue">{{ quiz.title }}</span>
            </h1>
            <p class="text-gray-400 text-sm tracking-widest">FINAL SCOREBOARD ANALYSIS</p>
        </div>

        <!-- Top 5 Participants List -->
        <div class="mb-10">
            <h2 class="text-lg font-orbitron text-pink-500 mb-6 flex items-center gap-2 border-b border-gray-800 pb-2">
                <i class="fas fa-trophy"></i> TOP 5 AGENTS
            </h2>

            <div class="flex flex-col">
                {% for taker in quiz_takers %}
                <!-- Rank Item -->
                <!-- Dynamically add classes rank-1, rank-2, rank-3 based on loop counter -->
                <div
                    class="rank-item {% if forloop.counter == 1 %}rank-1{% elif forloop.counter == 2 %}rank-2{% elif forloop.counter == 3 %}rank-3{% endif %}">
                    <div class="flex items-center w-full">
                        <div class="rank-badge">{{ forloop.counter }}</div>
                        <div class="player-name">{{ taker.alias }}</div>
                        <!-- Updated: Showing 'Score: Value' instead of 'Value XP' -->
                        <div class="player-score">Score: {{ taker.score }}</div>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8 text-gray-500 italic border border-gray-800 rounded bg-black/20">
                    No participant data available yet.
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Footer Action -->
        <!-- Footer Action Removed As Requested -->

        <!-- Decorative Corner Markers -->
        <div class="absolute top-0 left-0 w-3 h-3 border-t border-l border-blue-500"></div>
        <div class="absolute top-0 right-0 w-3 h-3 border-t border-r border-blue-500"></div>
        <div class="absolute bottom-0 left-0 w-3 h-3 border-b border-l border-blue-500"></div>
        <div class="absolute bottom-0 right-0 w-3 h-3 border-b border-r border-blue-500"></div>

    </div>
</div>

{% endblock %}